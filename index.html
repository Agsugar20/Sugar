<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>원고지 집필 대시보드</title>
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <style>
        :root { 
            --primary: #e74c3c; /* 원고지 붉은색 */
            --bg: #fdf6e3;      /* 따뜻한 미색 배경 */
            --card-bg: #ffffff; 
            --text: #2c3e50; 
            --line: #f5cfcf;    /* 연한 붉은 라인 */
        }
        body { font-family: 'Pretendard', 'Nanum Myeongjo', serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        .top-section { display: grid; grid-template-columns: 1fr 1.5fr; gap: 20px; max-width: 1200px; margin: 0 auto 30px; }
        .card { background: var(--card-bg); border-radius: 10px; padding: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid var(--line); }

        /* 좌측 대시보드 */
        .left-dash { display: flex; flex-direction: column; justify-content: center; text-align: center; border: 2px solid var(--primary); }
        #displayTitle { font-size: 1.2rem; color: var(--primary); font-weight: bold; border-bottom: 1px solid var(--line); padding-bottom: 10px; margin-bottom: 20px; }
        #displayPercent { font-size: 5rem; font-weight: 800; color: var(--primary); margin: 0; }
        .bar-bg { background: #eee; height: 8px; border-radius: 10px; margin: 30px auto; width: 80%; overflow: hidden; }
        .bar-fill { background: var(--primary); height: 100%; width: 0%; transition: 1s ease; }

        /* 우측 캘린더 */
        #calendar { background: white; padding: 10px; border-radius: 5px; height: 450px; }
        .fc-event { background: var(--primary) !important; border: none !important; color: white !important; padding: 2px; }
        .fc-daygrid-day.fc-day-today { background: rgba(231, 76, 60, 0.05) !important; }

        /* 하단 테이블 */
        .bottom-section { max-width: 1200px; margin: 0 auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { color: var(--primary); font-size: 0.8rem; border-bottom: 2px solid var(--primary); padding: 10px; }
        td { padding: 12px 5px; border-bottom: 1px solid var(--line); text-align: center; }
        input { border: 1px solid transparent; padding: 5px; text-align: center; font-family: inherit; font-size: 0.9rem; }
        input:focus { border-bottom: 1px solid var(--primary); outline: none; background: #fff5f5; }
        
        .active-row { background: #fff9f9; border-left: 4px solid var(--primary); }
        .record-btn { background: var(--primary); color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }
        .add-btn { background: white; color: var(--primary); border: 1px solid var(--primary); padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 20px; font-weight: bold; width: 100%; }
        .add-btn:hover { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="top-section">
    <div class="card left-dash">
        <div id="displayTitle">작품 선택 전</div>
        <div id="displayPercent">0%</div>
        <div class="bar-bg"><div id="progressBar" class="bar-fill"></div></div>
        <div id="displayStats" style="font-size: 0.9rem; color: #7f8c8d;">원고지에 마음을 담는 시간</div>
    </div>
    <div class="card">
        <div id='calendar'></div>
    </div>
</div>

<div class="bottom-section">
    <div class="card">
        <h2 style="font-size: 0.9rem; color: var(--primary);">원고지 워크시트</h2>
        <table>
            <thead>
                <tr>
                    <th>작품명</th>
                    <th>누적 자수</th>
                    <th>목표 자수</th>
                    <th>날짜 선택</th>
                    <th>집필량 입력</th>
                    <th>기록</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
        <button id="addBtn" class="add-btn" onclick="addNewRow()">+ 새 작품 추가 (최대 5개)</button>
    </div>
</div>

<script>
    let works = JSON.parse(localStorage.getItem('writerStudio_V3')) || [
        { title: "나의 소설 A", current: 0, target: 50000, dailyLogs: {} }
    ];
    let selectedIdx = 0;
    let calendar;

    document.addEventListener('DOMContentLoaded', function() {
        const calendarEl = document.getElementById('calendar');
        calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            height: 'auto',
            headerToolbar: { left: 'prev,next', center: 'title', right: 'today' },
            events: getCalendarEvents()
        });
        calendar.render();
        renderTable();
    });

    function getCalendarEvents() {
        const work =
