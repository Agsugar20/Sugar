<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Writing Studio - Multi</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script>

    <style>
        :root { 
            --primary: #f1c40f; --bg: #0f172a; --card-bg: #1e293b; --text: #e2e8f0; 
        }
        body { 
            font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text);
            display: flex; flex-direction: column; align-items: center; padding: 40px 20px; margin: 0;
        }
        .container { width: 100%; max-width: 900px; }
        .card { 
            background: var(--card-bg); padding: 30px; border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.05);
        }
        h2 { margin-top: 0; font-size: 1rem; color: var(--primary); opacity: 0.8; text-transform: uppercase; }
        
        /* ë©”ì¸ ìˆ˜ì‹ ë° ê²Œì´ì§€ */
        #percentageText { font-size: 2.5rem; font-weight: bold; margin-bottom: 10px; color: #fff; }
        .bar-bg { background: #334155; height: 10px; border-radius: 10px; overflow: hidden; margin: 20px 0; }
        .bar-fill { 
            background: linear-gradient(90deg, #f1c40f, #e67e22); height: 100%; width: 0%; 
            transition: 1s ease-in-out; box-shadow: 0 0 15px rgba(241, 196, 15, 0.4);
        }
        .formula-display { background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-top: 10px; }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ (ì—‘ì…€ ëŠë‚Œ) */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: rgba(15, 23, 42, 0.5); }
        th, td { padding: 12px; border: 1px solid #334155; text-align: center; }
        th { background: #0f172a; color: var(--primary); font-size: 0.9rem; }
        input[type="text"], input[type="number"] {
            width: 90%; background: transparent; border: none; color: white; text-align: center; font-size: 0.95rem;
        }
        input:focus { background: rgba(255,255,255,0.05); outline: none; }
        .add-btn { 
            margin-top: 15px; padding: 8px 15px; background: var(--primary); border: none; 
            border-radius: 5px; cursor: pointer; font-weight: bold; color: #000;
        }
        .active-row { background: rgba(241, 196, 15, 0.1) !important; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2 id="currentWorkTitle">ì„ íƒëœ ì‘í’ˆ ì—†ìŒ</h2>
        <div id="percentageText">0%</div>
        <div class="bar-bg"><div id="progressBar" class="bar-fill"></div></div>
        <div id="mathDisplay" class="formula-display"></div>
    </div>

    <div class="card">
        <h2>ğŸ“š ì‘í’ˆë³„ ì§‘í•„ ì‹œíŠ¸ (Work Sheet)</h2>
        <table id="workTable">
            <thead>
                <tr>
                    <th>ì‘í’ˆëª…</th>
                    <th>í˜„ì¬ ììˆ˜</th>
                    <th>ëª©í‘œ ììˆ˜</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
        <button class="add-btn" onclick="addNewRow()">+ ìƒˆ ì‘í’ˆ ì¶”ê°€</button>
    </div>
</div>

<script>
    let works = JSON.parse(localStorage.getItem('myWorks')) || [
        { title: "ì²« ë²ˆì§¸ ì†Œì„¤", current: 12500, target: 50000 }
    ];
    let selectedIdx = 0;

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        works.forEach((work, idx) => {
            const tr = document.createElement('tr');
            if(idx === selectedIdx) tr.className = 'active-row';
            tr.onclick = () => selectWork(idx);
            
            tr.innerHTML = `
                <td><input type="text" value="${work.title}" onchange="updateData(${idx}, 'title', this.value)"></td>
                <td><input type="number" value="${work.current}" onchange="updateData(${idx}, 'current', this.value)"></td>
                <td><input type="number" value="${work.target}" onchange="updateData(${idx}, 'target', this.value)"></td>
                <td><button onclick="deleteWork(${idx})" style="background:none; border:none; color:#ff7675; cursor:pointer;">ì‚­ì œ</button></td>
            `;
            tbody.appendChild(tr);
        });
        updateDashboard();
    }

    function updateData(idx, key, value) {
        works[idx][key] = key === 'title' ? value : parseInt(value) || 0;
        saveAndRender();
    }

    function selectWork(idx) {
        selectedIdx = idx;
        renderTable();
    }

    function addNewRow() {
        works.push({ title: "ìƒˆ ì‘í’ˆ", current: 0, target: 50000 });
        saveAndRender();
    }

    function deleteWork(idx) {
        if(works.length > 1) {
            works.splice(idx, 1);
            selectedIdx = 0;
            saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('myWorks', JSON.stringify(works));
        renderTable();
    }

    function updateDashboard() {
        const work = works[selectedIdx];
        if(!work) return;

        const percent = ((work.current / work.target) * 100).toFixed(1);
        const remaining = work.target - work.current;

        document.getElementById('currentWorkTitle').innerText = `Editing: ${work.title}`;
        document.getElementById('percentageText').innerText = `${percent}%`;
        document.getElementById('progressBar').style.width = `${percent}%`;

        // LaTeX ìˆ˜ì‹ (ìš”ì²­í•˜ì‹  ëŒ€ë¡œ í…ìŠ¤íŠ¸ ì œê±°)
        const formula = `
            P = \\frac{${work.current}}{${work.target}} \\times 100 = ${percent}\\% \\\\
            W_{rem} = ${work.target} - ${work.current} = ${remaining.toLocaleString()}
        `;
        
        const mathArea = document.getElementById('mathDisplay');
        mathArea.innerHTML = "$$" + formula + "$$";
        
        renderMathInElement(mathArea, { delimiters: [{left: "$$", right: "$$", display: true}] });
    }

    window.onload = renderTable;
</script>
</body>
</html>
